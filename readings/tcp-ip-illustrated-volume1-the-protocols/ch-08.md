## 第八章 Traceroute程序

Traceroute程序使用ICMP报文和IP首部中的TTL字段（生命周期）。每个处理该数据报的路由器都需要把TTL减1或者减去数据报在路由器中停留的秒数；

TTL的目的是防止数据报在选路时无休止地在网络中流动。若路由器收到一份IP数据报，如果其TTL字段是0或1，则路由器不转发该数据报，而是将该数据报丢弃，并给信源机发一份ICMP“超时”信息，其头部包含该路由器的IP地址，所以Traceroute可以利用该技巧实现其功能。

Traceroute程序发送数据报到达目标主机时，它选择了一个不可能的值作为UDP的`端口号`（大于30 000）使得目标主机的任何一个程序都不可能使用该端口。因为，当数据报到达时，将使目的主机的UDP模块产生一份**端口不可达**的错误的ICMP报文。

> NOTE: 运行Traceroute程序，这个程序界面通常要求用户具有root权限，这意味着它可能需要特殊的权限在你的主机上运行该程序；

对于每个**TTL**值，发送3份数据报。每接收到一份**ICMP**报文，将计算并打印往返时间。如果在5秒钟内仍未收到3份数据的任意一份的响应，则打印一个星号，并发送下一份数据报，直到到达目的主机。
